## 记录管理器

事务管理器能够在磁盘块上的指定位置读写值。但是，它不知道块中有哪些值，也不知道这些值可能位于何处。这是记录管理器的职责。它将一个文件组织成一个记录集合，并具有遍历记录并在其中放置值的方法。

### 1. 设计记录管理器

所以记录管理器必须解决几个问题，例如：

+ 每个记录是否应该完全放在一个区块内？
+ 一个块中的所有记录是否都来自同一个表？
+ 每个字段是否可以使用预定的字节数来表示？
+ 每个字段值应在其记录中放置的位置？

#### 1.1 跨区与非跨区记录

假设记录管理器需要在一个文件中插入四个 300 字节的记录，其中块大小为 1000字节。前三条记录很好地符合块的前 900 个字节。但对于第四个块，记录管理器应该怎么处理记录？

以下是两种处理方法：![image-20230215191652764](https://image-bed-693a.obs.cn-north-4.myhuaweicloud.com/imgbed/image-20230215191652764.png)

在图（a）中，记录管理器创建了一个跨区记录，即其值跨越了两个或多个块的记录。它将记录前的100个字节存储在现有块中，然后将记录的后200字节存储在新块中。在图（b）中记录将整个第四条记录存储在新块中。

非跨区记录的缺点有：

+ 浪费磁盘空间
+ 限制记录的大小要小于块，否则记录无法存储在一个块中

跨区存储的缺点有：

+ 增加了记录访问的复杂性，因为一个跨区记录被分割在几个块中，所以需要访问多个块来读取它。